#AJAX & JSON APIs

##Objectives
By the end of the lesson, you should be able to...

* Design a RESTful JSON API
* Retrieve Data from the API
* Use JQuery to append data to HTML elements
* Contrast how Handlebars can refactor your code
* Send data to the API and, on success, maintain state between the DB and the DOM

---

###AJAX
What is AJAX, how does it work? Think about using a `src` tag in an image. The image makes a request to another URL for a file.

AJAX is similar but instead of us asking for a picture we are asking for data—aka a .json file. In short, AJAX allows us to easily send and recieve json data to and from a server without reloading the page. Let's try it out using jQuery's native AJAX object!
 
* Go to an example [JSBin](http://jsbin.com/qamocegowe/7/edit?html,js,output) project
* **GOAL:** Discuss with a partner how you think the form is asking OMDB for information and how it is being returned to us. Be prepared to explain it to the class.

---

###Considering a Backend vs a Frontend API request
1) Ping the 3rd party API from the frontend
2) Ping the app's controller from the frontend, which in turn pings the 3rd party API

Differences:

* Obfuscation of API keys 
* CSRF issues
* Preference of 3rd party

---

###SPAs
Single-page apps (SPAs) are made possible in part due to the asynchronicity of Javascript. They provide fluid user experiences similar to native mobile/desktop applications.

Discussion Questions

* How would you explain an API to your grandmother? 
* Can you articulate the differences between a typical API and a JSON API
* What are the implications of have a centralized API?

---

##Exercise
Use AJAX to create single-page behavior in a Rails app.

* Clone the library app [here](git@github.com:sf-wdi-14/library_spa.git).
* **GOAL:** Setup the app and compare/contrast the books controller others you've built in the past.

###Setup

* Run `bundle`
* Run `rake db:create db:migrate db:seed` 
* (You may need to run `bundle exec` prior to any command if you are running a newer version of ruby)
* *Note:* the books controller renders JSON instead of HTML while the instruments controller does both and was generated by using the powerfully dangerous `scaffold` command.


---

###Fill the library

1) Create a `loadBooks` function in the **books.js** file that fetches all the the books in the database and sets them equal to a new variable in the global namespace.

For help, you can always reference the [JSBin](http://jsbin.com/qamocegowe/7/edit?html,js,output) example on hitting the OMDB API with AJAX.

* **GOAL:** Get an AJAX GET request to `/books` working so that you retrieve all the books in the database.

---

###Displaying your Data — Part 1

* Go back to an example [JSBin](http://jsbin.com/qamocegowe/7/edit?html,js,output) project.
* **GOAL:** Uncomment out the commented lines and now try to search a new movie. With a parter discuss what is happening to now display this data onto the page. Be prepared to explain it to the class.

---

###Displaying your Data — Part 2

* Now you try!

* **GOAL:** When the responce is recieved (aka `.done`) you will need to append the data to the page in a similar fashion to our OMDB app.

* Here are the steps we must consider:
	* Create an empty unordered list
	* Loop through the AJAX response and on each iteration create an li that contains the book's title and author. The format should be "Book by Author"
	* Append the li to the ul
	* After all the li's have been appended to the ul, you can then append the ul to 

Aim to have this function execute once the document is ready.

---

##Further Learning

* Use the gem `rails-api` if you're ever looking to simply impliment a barebones rails API

##Lab

* Finish this exercise.
* Familiarize yourself with the AJAX functionality of JQuery.
* Add an AJAX request to our rails-review [app](https://github.com/sf-wdi-14/rails-review)


